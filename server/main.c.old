#include <stdio.h>
#include <zlib.h>
#include <jansson.h>

static const char compressed[] = {
    120, -38, 93, 83, 73, 114, 27, 49, 12, -52, -103, -81, -64, 11, -26,
    15, 62, -8, -112, -117, -99, 56, -107, -36, 41, 14, 36, -93, -118,
    -101, -71, -88, -12, -4, 52, 72, -51, -110, 92, -92, 26, -110, 104,
    116, 55, 26, -81, -10, -85, 51, 125, 117, 27, 104, 77, 62, 21, 38,
    111, 47, -87, 72, -86, 56, -87, -46, -120, -93, -124, -123, 94, -15,
    75, -4, 112, -100, 91, 47, -126, -9, 82, -55, -91, 88, 25, -107, 56,
    33, -109, 66, -60, -111, -84, 11, -67, 73, 21, -70, 39, -33, 115,
    -77, -115, 1, 43, 55, 92, 85, 9, -87, 82, -70, 94, -59, 9, 30, -58,
    84, 91, -23, -31, -4, -18, -50, 94, -38, 66, -26, -125, 93, -81, 54,
    -82, -106, -87, 90, -50, 60, 88, 108, -17, -47, -82, 106, -9, -123,
    -66, 123, -33, -107, 18, 23, 39, 0, -112, 20, -127, -111, -117, -27,
    -54, -79, 9, -82, -116, 75, -91, 0, 92, 40, 36, -49, -75, 9, 0, 67,
    90, -27, -119, -6, 41, 110, -95, -105, -95, 100, -88, -9, -74, -81,
    118, 86, 22, 30, -44, -108, 15, -103, 81, -126, 87, 4, -114, 89, -3,
    -39, 52, 44, -58, -68, 74, -81, -44, -67, 71, -7, -44, 63, 44, 36,
    -21, 84, 65, -64, 93, 65, 39, 92, -125, -65, -102, -46, 33, -17, 71,
    82, 43, 112, 5, 88, -96, 23, 6, 22, -57, 117, -85, 101, -110, -38,
    120, -95, -33, 77, 107, -5, 42, -45, 8, 30, -84, -114, -17, -88, 77,
    23, -6, 9, 90, 99, 92, 76, 6, 20, 47, -67, -82, 54, -20, -110, 32,
    -49, 11, -20, -110, -112, 89, -101, 77, -35, -93, 77, 127, 78, 27,
    3, -5, -49, 66, -88, 122, 95, 37, -47, -75, -33, 80, 98, 123, 123,
    62, -44, 33, -100, 6, -66, -48, -5, 16, 60, -83, 58, 83, -109, 92,
    45, -103, 59, -105, 1, 89, 41, -37, 34, 35, 34, -8, 70, -44, 64,
    106, 119, -57, 102, -68, 2, -31, -61, -81, 83, 28, 76, -75, 25, -50,
    52, 30, -26, -13, 99, 104, -128, -26, 63, 99, 44, -82, -5, 108, 9,
    -10, -73, 68, 56, -72, -87, -123, 84, -90, 6, -30, 118, 0, -111,
    -103, -66, -94, -37, 69, 13, 67, 8, -7, 49, 66, 77, 124, -57, 31,
    99, 38, 111, -49, 112, 73, -60, 73, -37, 119, 0, 54, 115, 117, -46,
    99, -125, 41, -93, 18, -90, -40, 127, 98, -65, 117, -124, 79, -96,
    -68, 43, 12, -68, 49, -100, -79, -80, 94, 70, -58, -52, -64, -43,
    -40, -42, -54, 59, 71, 124, 31, 9, 125, 30, 86, 8, 61, -68, 8, 2,
    -66, 118, 76, -125, -57, -66, -102, -31, 50, 34, -84, -26, -84, -84,
    11, -6, -56, 94, 28, -32, 85, 94, -20, 97, -12, -125, -65, 53, 35,
    96, 99, 16, -10, -78, 27, 126, -54, -70, 25, -15, 69, 125, 59, -106,
    115, 27, 58, -78, -114, -11, 73, 84, 89, 83, -78, -31, 99, 47, -56,
    -53, -123, 75, -102, 1, 52, 8, 111, -109, -24, -12, 37, -61, -92,
    85, 92, -77, 19, 64, 19, 9, -17, 94, 0, -88, 92, -25, -100, 103,
    -33, -79, 86, 26, -21, 42, -15, 52, -82, -96, -104, -56, -20, -43,
    58, -15, 123, -66, -84, 26, -86, 9, -57, -56, -93, -109, 85, 71, 66,
    31, -100, 11, 127, 98, -16, 26, 53, -54, -34, 58, -58, -94, -51,
    109, 44, 10, -12, 75, 51, -81, -24, -37, 2, -104, -67, 77, 61, -101,
    127, -15, 72, -82, 52, 85, 126, -60, 6, -69, 106, -66, -3, 5, 35,
    -94, -30, -66
};

static const char jsonstring[] = "{\"data\": \"Hello world!\"}";

int main() {
    char uncompressed[2000];
    unsigned long len;
    int ok;

    len = sizeof(uncompressed);
    ok = uncompress(uncompressed, &len, compressed, sizeof(compressed));

    if (ok != Z_OK) {
        puts(zError(ok));
        return -1;
    }

    puts(uncompressed);

    json_error_t err;
    json_t *obj = json_loads(jsonstring, 0, &err);

    if (obj == NULL) {
        puts(err.text);
        return -1;
    }

    const char *fieldstring = json_string_value(json_object_get(obj, "data"));

    if (fieldstring == NULL) {
        puts("Invalid JSON");
        return -1;
    }

    puts(fieldstring);
    json_decref(obj);

    return 0;
}
